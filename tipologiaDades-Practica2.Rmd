---
title: "TipologiaDades-Practica2"
author: "Silvia Benet, Marc Garrido"
date: "15/5/2020"
output:
  html_document:
    highlight: default
    number_sections: no
    theme: cosmo
    toc: yes
    toc_depth: 3
  word_document: default
  pdf_document:
    highlight: zenburn
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

******
# Introducció
******
## Descripció del Dataset

https://www.kaggle.com/uciml/red-wine-quality-cortez-et-al-2009

```{r }

library(ggplot2)
library(dplyr)

wineQualityRed <- read.csv('winequality-red.csv', stringsAsFactors = FALSE, header = TRUE, sep=";")

names(wineQualityRed) <- c("fixedacidity",
   "volatileacidity",
   "citricacid",
   "residualsugar",
   "chlorides",
   "freesulfurdioxide",
   "totalsulfurdioxide",
   "density",
   "pH",
   "sulphates",
   "alcohol",
   "quality")

wineQualityWhite <- read.csv('winequality-white.csv', stringsAsFactors = FALSE, header = TRUE, sep=";")


```

## Neteja de les dades

Comprovem l'estructura del joc de dades

```{r }
str(wineQualityRed)
```

Mirem un resum per fer un cop d'ull quins valors tenim
```{r }
summary(wineQualityRed)
```
Amb un summary podem veure més o menys com són les dades per fer-nos una primera idea.
Mirarem si hi ha zeros i nulls
```{r }
colSums(is.na(wineQualityRed))
colSums(wineQualityRed=="")

```
No hi ha valors a 0 ni nulls. No semba que hi hagi valors perduts (ni N/A ni altres valors). 

## 3.2 Identificació de valors extrems (outliers)

Utilitzant boxplot comprovarem si les variables tenen valors extrems i si aquests valors poden ser considerats vàlids i per tant s'han de tenir en compte o si al contrari són valors invàlids i s'han de tractar o eliminar. 

```{r }
par(mfrow=c(2,2))
boxplot(wineQualityRed$fixedacidity,xlab="fixedacidity")
boxplot(wineQualityRed$volatileacidity,xlab="volatileacidity") 
boxplot(wineQualityRed$citricacid, xlab="citricacid")
boxplot(wineQualityRed$residualsugar,xlab="residualsugar")
boxplot(wineQualityRed$chlorides, xlab="chlorides")
boxplot(wineQualityRed$freesulfurdioxide, xlab ="freesulfurdioxide")
boxplot(wineQualityRed$totalsulfurdioxide,xlab ="totalsulfurdioxide" )
boxplot(wineQualityRed$density, xlab ="density")
boxplot(wineQualityRed$pH, xlab ="pH")
boxplot(wineQualityRed$sulphates, xlab ="sulphates")
boxplot(wineQualityRed$alcohol,xlab="alcohol")
boxplot(wineQualityRed$quality, xlab ="quality")

```

Citricacid té només un valor que està allunyat de la resta. Mirem quin és:
```{r }

boxplot(wineQualityRed$citricacid, plot =FALSE)$out

```
Amb un summary podrem veure quins són els valors i quin és valor màxim per veure si realment està tan allunyat i és un valor no vàlid.

```{r }
summary(wineQualityRed$citricacid)
plot(wineQualityRed$citricacid)
```

El valor que semblaria outiler és 1, el rang de la variable oscil.la entre 0 i 1, i hi ha valors de 0,8 així que no sembla pas un error. El deixarem tal com està.

Comprovarem totalsulfurdioxide perquè també sembla qeu tingui alguns valors allunyats:

```{r }
boxplot(wineQualityRed$totalsulfurdioxide, plot =FALSE)$out
summary(wineQualityRed$totalsulfurdioxide)
plot(wineQualityRed$totalsulfurdioxide)
```

Aquests dos valors si que es veuen ben diferenciats de la resta. Mirem quina informació dóna la seva fila per veure si discernim si són valors correctes o incorrectes.
El valor màxim és 289:
```{r }

wineQualityRed[wineQualityRed$totalsulfurdioxide==289,]
wineQualityRed[wineQualityRed$totalsulfurdioxide==278,]

```

Els valors de totes les variables semblen normals per tant suposarem que els valors d'aquesta variable són correctes. Tal com comenta a:https://archive.ics.uci.edu/ml/datasets/wine+quality els algoritmes d'outliers poden ajudar a detectar els vins excelents o molt pobres i de fet es pot veure que aquests dos valors tenen qualitat = 7 que és alta. Veurem més endavant si aquesta variable té un pes important en la qualitat dels vins.

La resta de variables no sembla que presentin outliers. Hi ha alguns valors fora de la normalitat però no s'en veu cap sol i molt allunyat de tota la resta.

# Comprovem la normalitat de les dades

Amb l'histograma podem veure que sembla que segueix una distribució normal. Per assegurar realitzarem una gràfica qq cuantil - cuantil (qqplot)

```{r }
qqnorm(wineQualityRed$quality,main = paste("Normal Q-Q Plot for "))
qqline(wineQualityRed$quality,col="red")

```
Per comprovar-ho realment utilitzarem el test de Anderson-Darling per totes les variables:

```{r }

library(nortest)

hist(wineQualityRed[,1])
ad.test(wineQualityRed[,1])

alpha <- 0.05
col.names = colnames(wineQualityRed)

for (i in 1:ncol(wineQualityRed)) {

   if (is.integer(wineQualityRed[,i]) | is.numeric(wineQualityRed[,i])) {
      p_val = ad.test(wineQualityRed[,i])$p.value
      if (p_val < alpha) {
       cat("No Normal: ") + cat(col.names[i]) + cat("- p-value:") + cat(p_val) + cat("\n")
      }
      else {
         cat ("Normal: ") + cat(col.names[i]) + cat("- p-value:") + cat(p_val) + cat("\n")
      }
   }
}

```
Segons el test d'Anderson-Darling no hi ha cap variable que segueixi una distribució normal.

?????? QUe FEM???
ESCALEM LES VARIABles que estàn totes en diferents escales??

# Comprovem la variança

Comparem si la variança és homogènia comparant els vins blancs amb els vins negres




# MirAR normalitat i variança

# BUsCAR CORRELACIONS
# Agafem els vins blancs i fem dos grups???????
# Anàlisis PCA?
# Regressió lineal
# Arbre de decisió?? (discretitzar quality) o kmeans?
